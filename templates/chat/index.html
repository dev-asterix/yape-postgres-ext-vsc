<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="{{CSP}}">
  <title>PostgreSQL Chat</title>
  <link rel="stylesheet" href="{{HIGHLIGHT_CSS_URI}}">
  <script src="{{MARKED_URI}}"></script>
  <script src="{{HIGHLIGHT_JS_URI}}"></script>
  <style>{{INLINE_STYLES}}</style>
</head>

<body data-vscode-theme-kind="">
  <script>{{THEME_DETECTION_SCRIPT}}</script>
  <div class="main-container">
    <!-- History Overlay -->
    <div class="history-overlay" id="historyOverlay" onclick="closeHistory(event)">
      <div class="history-panel" onclick="event.stopPropagation()">
        <div class="history-header">
          <h3>üìö Chat History</h3>
          <button class="history-close-btn" onclick="toggleHistory()" title="Close">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
              <path
                d="M8 8.707l3.646 3.647.708-.707L8.707 8l3.647-3.646-.707-.708L8 7.293 4.354 3.646l-.708.708L7.293 8l-3.647 3.646.708.708L8 8.707z" />
            </svg>
          </button>
        </div>
        <div class="history-search">
          <input type="text" id="historySearch" placeholder="üîç Search chats..." oninput="filterHistory(this.value)">
        </div>
        <div class="history-list" id="historyList">
          <div class="history-empty">No chat history yet</div>
        </div>
      </div>
    </div>

    <div class="chat-container">
      <div class="chat-header">
        <div class="chat-header-left">
          <button class="header-btn" onclick="toggleHistory()" title="Chat History">
            <svg viewBox="0 0 16 16" fill="currentColor">
              <path d="M8 1a7 7 0 1 0 0 14A7 7 0 0 0 8 1zM0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8z" />
              <path d="M8 3.5a.5.5 0 0 1 .5.5v4H12a.5.5 0 0 1 0 1H8a.5.5 0 0 1-.5-.5V4a.5.5 0 0 1 .5-.5z" />
            </svg>
          </button>
          <h3><span class="header-icon">üêò</span></h3>
          <span class="ai-model-badge" onclick="openAiSettings()" title="Click to configure AI settings"
            id="aiModelBadge">
            <span class="sparkle-icon">‚ú®</span>
            <span id="aiModelName">Loading...</span>
          </span>
        </div>
        <div class="chat-header-right">
          <button class="header-btn" onclick="newChat()" title="New Chat">
            <svg viewBox="0 0 16 16" fill="currentColor">
              <path
                d="M8 2a.5.5 0 0 1 .5.5v5h5a.5.5 0 0 1 0 1h-5v5a.5.5 0 0 1-1 0v-5h-5a.5.5 0 0 1 0-1h5v-5A.5.5 0 0 1 8 2z" />
            </svg>
          </button>
          <button class="header-btn" onclick="clearChat()" title="Clear Current Chat">
            <svg viewBox="0 0 16 16" fill="currentColor">
              <path
                d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z" />
              <path fill-rule="evenodd"
                d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4L4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z" />
            </svg>
          </button>
        </div>
      </div>

      <div class="messages-container" id="messagesContainer">
        <div class="empty-state" id="emptyState">
          <div class="empty-state-icon">üí¨</div>
          <div class="empty-state-text">
            Ask questions about PostgreSQL<br />
            Get help writing queries<br />
            Generating performant SQL statements<br />
            Explore database concepts
          </div>
          <div class="empty-state-hint">
            <span>‚ö°</span> Powered by You & AI
          </div>
          <div class="suggestions">
            <button class="suggestion-btn" onclick="sendSuggestion('How do I write a JOIN query?')">JOINs</button>
            <button class="suggestion-btn" onclick="sendSuggestion('Explain CTEs in PostgreSQL')">CTEs</button>
            <button class="suggestion-btn" onclick="sendSuggestion('How to optimize a slow query?')">Optimize</button>
            <button class="suggestion-btn" onclick="sendSuggestion('What are window functions?')">Window Fn</button>
          </div>
        </div>
        <div class="typing-indicator" id="typingIndicator">
          <div class="typing-dots">
            <span></span>
            <span></span>
            <span></span>
          </div>
          <div class="loading-text" id="loadingText"></div>
        </div>
      </div>

      <div class="input-wrapper" id="inputWrapper">
        <div class="mention-picker" id="mentionPicker">
          <div class="mention-picker-header">
            <span>üîó Reference DB Object</span>
          </div>
          <input type="text" class="mention-picker-search" id="mentionSearch"
            placeholder="Search tables, views, functions..." oninput="searchMentions(this.value)"
            onkeydown="handleMentionSearchKeydown(event)">
          <div class="mention-picker-list" id="mentionList">
            <div class="mention-picker-loading">Loading database objects...</div>
          </div>
        </div>
        <div class="attachments-container" id="attachmentsContainer"></div>
        <div class="input-container">
          <button class="attach-btn" id="attachBtn" onclick="attachFile()" title="Attach file (SQL, CSV, JSON, TXT)">
            <svg viewBox="0 0 16 16" fill="currentColor">
              <path
                d="M11.5 2c1.4 0 2.5 1.1 2.5 2.5v6c0 2.5-2 4.5-4.5 4.5S5 13 5 10.5V4h1v6.5c0 1.9 1.6 3.5 3.5 3.5s3.5-1.6 3.5-3.5v-6c0-.8-.7-1.5-1.5-1.5S10 3.7 10 4.5v6c0 .3.2.5.5.5s.5-.2.5-.5V5h1v5.5c0 .8-.7 1.5-1.5 1.5S9 11.3 9 10.5v-6C9 3.1 10.1 2 11.5 2z" />
            </svg>
          </button>
          <button class="mention-btn" id="mentionBtn" onclick="toggleMentionPicker()"
            title="Reference a database object (@)">@</button>
          <textarea class="chat-input" id="chatInput"
            placeholder="Ask anything about PostgreSQL... (@ to reference tables)" rows="1"
            onkeydown="handleKeyDown(event)" oninput="handleChatInput(event)"></textarea>
          <button class="send-btn" id="sendBtn" onclick="sendMessage()" title="Send message">
            <svg viewBox="0 0 16 16" fill="currentColor">
              <path d="M1.5 1.5L14.5 8L1.5 14.5V9L10.5 8L1.5 7V1.5Z" />
            </svg>
          </button>
          <button class="stop-btn" id="stopBtn" onclick="cancelRequest()" title="Stop generation"
            style="display: none;">
            <svg viewBox="0 0 16 16" fill="currentColor">
              <rect x="3" y="3" width="10" height="10" rx="1" />
            </svg>
          </button>
        </div>
      </div>
    </div>
  </div>

  <script>{{INLINE_SCRIPTS}}</script>
</body>

</html>
